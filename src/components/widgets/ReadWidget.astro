---
interface Book {
  title: string;
  author: string;
  coverUrl?: string;
  progress?: number;
}

interface ReadingData {
  lastUpdated: string | null;
  currentlyReading: Book[];
  finished: Book[];
  wantToRead: Book[];
}

let data: ReadingData = { lastUpdated: null, currentlyReading: [], finished: [], wantToRead: [] };
try {
  data = (await import('../../data/reading.json')).default as ReadingData;
} catch { /* data unavailable */ }

const currentBook = data.currentlyReading[0] ?? null;
---

<article class="gvns-widget gvns-widget--read">
  <div class="gvns-widget__label">Read</div>
  {currentBook ? (
    <div class="gvns-widget__content gvns-widget__content--row">
      {currentBook.coverUrl && (
        <img
          src={currentBook.coverUrl}
          alt={`Cover of ${currentBook.title}`}
          class="gvns-widget__cover"
          width="64"
          height="96"
          loading="lazy"
          decoding="async"
        />
      )}
      <div>
        <p class="gvns-widget__detail gvns-widget__detail--bold">{currentBook.title}</p>
        <p class="gvns-widget__meta">{currentBook.author}</p>
        {typeof currentBook.progress === 'number' && (
          <div class="gvns-widget__progress">
            <div class="gvns-widget__progress-bar" style={`width: ${currentBook.progress}%`} role="progressbar" aria-valuenow={currentBook.progress} aria-valuemin={0} aria-valuemax={100}>
              <span class="sr-only">{currentBook.progress}% complete</span>
            </div>
          </div>
        )}
      </div>
    </div>
  ) : (
    <p class="gvns-widget__empty">Nothing on the nightstand.</p>
  )}
  <a href="/read" class="gvns-widget__link">
    View Full Activity <span aria-hidden="true">&rarr;</span>
  </a>
</article>

<style>
  .gvns-widget--read {
    border-left-color: var(--colour-p2-rose);
  }

  .gvns-widget--read .gvns-widget__link:hover {
    color: var(--colour-p2-rose);
  }

  .gvns-widget__cover {
    border-radius: 4px;
    object-fit: cover;
    flex-shrink: 0;
  }

  .gvns-widget__progress {
    height: 4px;
    background: var(--colour-bg-tertiary);
    border-radius: 2px;
    margin-top: var(--space-2);
    overflow: hidden;
  }

  .gvns-widget__progress-bar {
    height: 100%;
    background: var(--colour-p2-rose);
    border-radius: 2px;
    transition: width var(--transition-base);
  }
</style>
