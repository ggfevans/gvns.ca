---
import { relativeTime } from '@utils/format';

interface Commit {
  repo: string;
  message: string;
  sha: string;
  date: string;
  url: string;
}

interface GitHubData {
  lastUpdated: string | null;
  recentCommits: Commit[];
  stats: { commitsThisWeek: number; commitsThisMonth: number; repositoriesThisWeek: number };
  repositories: { name: string; description: string; language: string; stars: number; url: string }[];
}

let data: GitHubData = { lastUpdated: null, recentCommits: [], stats: { commitsThisWeek: 0, commitsThisMonth: 0, repositoriesThisWeek: 0 }, repositories: [] };
try {
  data = (await import('../../data/github.json')).default as GitHubData;
} catch { /* data unavailable */ }

const latestCommit = data.recentCommits[0] ?? null;
---

<article class="gvns-widget gvns-widget--code">
  <div class="gvns-widget__label">Code</div>
  {latestCommit ? (
    <div class="gvns-widget__content">
      <p class="gvns-widget__repo">{latestCommit.repo}</p>
      <p class="gvns-widget__detail">{latestCommit.message}</p>
      <time class="gvns-widget__time" datetime={latestCommit.date}>
        {relativeTime(latestCommit.date)}
      </time>
    </div>
  ) : (
    <p class="gvns-widget__empty">No recent commits.</p>
  )}
  <a href="/code" class="gvns-widget__link">
    View Full Activity <span aria-hidden="true">&rarr;</span>
  </a>
</article>

<style>
  .gvns-widget--code {
    border-left-color: var(--colour-p1-violet);
  }

  .gvns-widget--code .gvns-widget__link:hover {
    color: var(--colour-p1-violet);
  }

  .gvns-widget__repo {
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    color: var(--colour-p1-violet);
    margin: 0 0 var(--space-1) 0;
  }
</style>
